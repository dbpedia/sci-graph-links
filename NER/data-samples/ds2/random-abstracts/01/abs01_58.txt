Abstract We study the portfolio optimization problem of maximizing the outperformance probability over a random benchmark through dynamic trading with a fixed initial capital. Under a general incomplete market framework, this stochastic control problem can be formulated as a composite pure hypothesis testing problem. We analyze the connection between this pure testing problem and its randomized counterpart, and from the latter we derive a dual representation for the maximal outperformance probability. Moreover, in a complete market setting, we provide a closed-form solution to the problem of beating a leveraged exchange traded fund. For a general benchmark under an incomplete stochastic factor model, we provide the Hamilton–Jacobi–Bellman PDE characterization for the maximal outperformance probability.